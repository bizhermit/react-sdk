"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,s){void 0===s&&(s=a),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,s){void 0===s&&(s=a),e[s]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.MessageBox=exports.messageBoxClassName=void 0;const react_1=__importStar(require("react")),react_dom_1=__importDefault(require("react-dom")),button_1=__importDefault(require("../controls/button")),textbox_1=__importDefault(require("../controls/textbox")),icon_1=__importDefault(require("../graphics/icon")),style_1=__importStar(require("../layouts/style")),controller_1=__importDefault(require("./controller")),popup_1=require("./popup");exports.messageBoxClassName="bh-msg_box";const MessageBox=e=>{const t=(0,react_1.useRef)(),a=(0,controller_1.default)(),s=e=>{"Tab"===e.key&&e.preventDefault()},n=()=>{a.focus?.()},l=t=>{!0!==e.preventButtonClickEvent&&t.click?.({}),e.click?.(t)};(0,react_1.useEffect)((()=>{t.current.style.removeProperty("display");const e=t.current.offsetHeight,a=t.current.offsetWidth,s=document.body.getBoundingClientRect();t.current.style.top=String((s.height-e)/2)+"px",t.current.style.left=String((s.width-a)/2)+"px",t.current.style.removeProperty("visibility"),n()}),[]);const r=(0,react_1.useMemo)((()=>{const t=[];for(const s of e.buttons)null!=e.textbox?t.push(react_1.default.createElement(button_1.default,{key:s.code,click:()=>{l(s)}},s.text)):t.push(react_1.default.createElement(button_1.default,{key:s.code,controller:a,click:()=>{l(s)}},s.text));return t}),[]);return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{className:`${popup_1.PopupClassNames.m_p} ${exports.messageBoxClassName}-mask`,tabIndex:0,onKeyDown:s,onFocus:n}),react_1.default.createElement("div",{ref:t,className:`${popup_1.PopupClassNames.b} ${exports.messageBoxClassName}`,style:{visibility:"hidden",display:"none",top:0,left:0}},null==e.title?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${exports.messageBoxClassName}-header`},e.title),react_1.default.createElement("div",{className:`${exports.messageBoxClassName}-body`},react_1.default.createElement("div",{className:`${exports.messageBoxClassName}-content`},null==e.iconImage?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement(icon_1.default,{className:`${exports.messageBoxClassName}-icon`,image:e.iconImage}),react_1.default.createElement("div",{className:`${exports.messageBoxClassName}-message`,"data-type":typeof e.message},e.message)),null==e.textbox?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement(textbox_1.default,{...e.textbox,controller:a,name:"value",bind:e.bind,style:{width:e.textbox?.width}})),react_1.default.createElement("div",{className:`${exports.messageBoxClassName}-footer`},r)),react_1.default.createElement("div",{className:`${popup_1.PopupClassNames.m_s} ${exports.messageBoxClassName}-mask`,tabIndex:0,onKeyDown:s,onFocus:n}),popup_1.PopupStyle,MessageBoxStyle)};exports.MessageBox=MessageBox;const MessageBoxContext={layout:null,open:e=>new Promise(((t,a)=>{const s=document.createElement("div");document.body.appendChild(s);const n={value:e.textbox?.defaultValue??null};react_dom_1.default.render(react_1.default.createElement(style_1.StyleContext.Provider,{value:MessageBoxContext.layout},react_1.default.createElement(exports.MessageBox,{...e,click:e=>{react_dom_1.default.unmountComponentAtNode(s),e.click?.(n),t(e.code)},bind:n,preventButtonClickEvent:!0})),s)})),alert:e=>MessageBoxContext.open({message:e,buttons:[{code:"ok",text:"OK"}]}),confirm:async e=>{const t=e?.title??"確認";let a=e?.message??"よろしいですか？";switch(e?.template){case"delete":a=react_1.default.createElement(react_1.default.Fragment,null,null==e?.subject?"":`${e.subject}を`,"削除します。",react_1.default.createElement("br",null),"よろしいですか？");break;case"registration":a=react_1.default.createElement(react_1.default.Fragment,null,null==e?.subject?"":`${e.subject}を`,"登録します。",react_1.default.createElement("br",null),"よろしいですか？");break;case"update":a=react_1.default.createElement(react_1.default.Fragment,null,null==e?.subject?"":`${e.subject}を`,"更新します。",react_1.default.createElement("br",null),"よろしいですか？");break;case"modification":a=react_1.default.createElement(react_1.default.Fragment,null,null==e?.subject?"":`${e.subject}を`,"変更します。",react_1.default.createElement("br",null),"よろしいですか？");break;case"save":a=react_1.default.createElement(react_1.default.Fragment,null,null==e?.subject?"":`${e.subject}を`,"保存します。",react_1.default.createElement("br",null),"よろしいですか？");break;case"saveover":a=react_1.default.createElement(react_1.default.Fragment,null,null==e?.subject?"":`${e.subject}を`,"上書き保存します。",react_1.default.createElement("br",null),"よろしいですか？");break;case"saveas":a=react_1.default.createElement(react_1.default.Fragment,null,null==e?.subject?"":`${e.subject}を`,"別名で保存します。",react_1.default.createElement("br",null),"よろしいですか？")}return"ok"===await MessageBoxContext.open({title:t,message:a,iconImage:e?.iconImage,buttons:[{code:"ok",text:"OK"},{code:"cancel",text:"キャンセル"}]})},textbox:async e=>{let t="";return"ok"!==await MessageBoxContext.open({message:e.message,title:e.title,textbox:{width:e.textboxWidth,defaultValue:e.defaultValue,options:e.textboxOptions},buttons:[{code:"ok",text:"OK",click:e=>{t=e.value}},{code:"cancel",text:"キャンセル"}]})?{judge:!1,value:null}:{judge:!0,value:t}}},MessageBoxStyle=react_1.default.createElement(style_1.default,{id:exports.messageBoxClassName,notDepsColor:!0,css:({design:e})=>`\n.${exports.messageBoxClassName} {\n  z-index: 2147483647;\n  max-height: 80%;\n  max-width: 80%;\n  min-width: 200px;\n  background: ${style_1.CssVar.bg.c};\n}\n.${exports.messageBoxClassName}-header {\n  ${style_1.CssPV.flex_r}\n  flex: none;\n  height: ${style_1.CssVar.size};\n  padding: 1px 5px 0px 5px;\n}\n.${exports.messageBoxClassName}-body {\n  ${style_1.CssPV.flex}\n  flex-flow: column nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n  ${style_1.CssPV.f_y}\n}\n.${exports.messageBoxClassName}-content {\n  ${style_1.CssPV.flex_r}\n  flex: none;\n  min-height: ${style_1.CssVar.size};\n}\n.${exports.messageBoxClassName}-message[data-type="string"] {\n  padding-top: 2px;\n}\n.${exports.messageBoxClassName}-icon {\n  margin-right: 10px;\n}\n.${exports.messageBoxClassName}-footer {\n  ${style_1.CssPV.flex}\n  flex-flow: row nowrap;\n  justify-content: flex-end;\n  align-items: center;\n  flex: none;\n}\n.${exports.messageBoxClassName}-mask {\n  z-index: 2147483646;\n}\n${"material"===e?`\n.${exports.messageBoxClassName} {\n  border-radius: ${style_1.CssParam.m.r};\n  border: 1px solid ${style_1.CssVar.bdc};\n}\n.${exports.messageBoxClassName}-header {\n  border-bottom: 1px solid ${style_1.CssVar.bdc};\n  box-shadow: ${style_1.CssParam.m.sdBtm};\n  background: ${style_1.CssVar.bg.c_h};\n}\n.${exports.messageBoxClassName}-body {\n  padding: 5px 10px;\n}\n.${exports.messageBoxClassName}-header + .${exports.messageBoxClassName}-body {\n  padding-top: calc(${style_1.CssParam.m.sdPdd} + 5px);\n}\n.${exports.messageBoxClassName}-footer {\n  padding: 0px 5px 5px 5px;\n}\n`:""}\n${"neumorphism"===e?`\n.${exports.messageBoxClassName} {\n  border-radius: ${style_1.CssParam.n.r};\n  box-shadow: ${style_1.CssParam.n.border.cvxSd};\n  padding: ${style_1.CssParam.n.accent.sdPdd};\n}\n.${exports.messageBoxClassName}-header {\n  box-shadow: ${style_1.CssParam.n.accent.cvxSd};\n  background: ${style_1.CssParam.n.headerCvxBg};\n  border-radius: ${style_1.CssParam.n.r};\n}\n.${exports.messageBoxClassName}-body {\n  padding: ${style_1.CssParam.n.accent.sdPdd};\n}\n.${exports.messageBoxClassName}-header + .${exports.messageBoxClassName}-body {\n  padding-top: calc(${style_1.CssParam.n.accent.sdPdd} * 2);\n}\n`:""}\n`}),useMessageBox=()=>(MessageBoxContext.layout=(0,style_1.useLayout)(),MessageBoxContext);exports.default=useMessageBox;