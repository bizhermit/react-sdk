"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,n,a){void 0===a&&(a=n),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,a){void 0===a&&(a=n),e[a]=t[n]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DialogWindowStyle=exports.DialogWindow=exports.dialogWindowClassName=void 0;const react_1=__importStar(require("react")),react_dom_1=__importDefault(require("react-dom")),icon_1=__importDefault(require("../graphics/icon")),style_1=__importStar(require("../layouts/style")),classname_utils_1=require("../utils/classname-utils"),dom_utils_1=require("../utils/dom-utils"),popup_1=require("./popup");exports.dialogWindowClassName="bh-dw";const resizeSize=`var(--${exports.dialogWindowClassName}-resize-size, 8px)`,dialogWindowBaseZIndex=1e8,dialogWindowZIndexInterval=5,DialogWindow=e=>{const t=(0,react_1.useRef)(),n=(0,react_1.useRef)(),[a,s]=(0,react_1.useState)(e.zIndex),[r,o]=(0,react_1.useState)((()=>!0===e.fullScreen?"maximize":"")),i=e=>{"Tab"===e.key&&e.preventDefault()},l=(n,a,s,o,i)=>{if(!1===e.resize||"maximize"===r)return;const l=n.clientX,d=n.clientY;let c=0,m=0,u=0,h=0,p=0,x=0,g=0,_=0,w=!1,f=!1,C=!1,b=!1;const y=t.current.getBoundingClientRect(),$=document.body.getBoundingClientRect();a&&(C=!0,s?(c=t.current.offsetLeft,h=y.width,x=t.current.offsetLeft+y.width,_=x-0,f=!0):(c=y.width,x=$.width-t.current.offsetLeft)),o&&(b=!0,i?(m=t.current.offsetTop,u=y.height,p=t.current.offsetTop+y.height,g=p-0,w=!0):(m=y.height,p=$.height-t.current.offsetTop));const z=e=>{C&&(f?(t.current.style.left=Math.max(0,Math.min(_,c+e.clientX-l))+"px",t.current.style.width=Math.max(0,Math.min(x,h-e.clientX+l))+"px"):t.current.style.width=Math.max(0,Math.min(x,c+e.clientX-l))+"px"),b&&(w?(t.current.style.top=Math.max(0,Math.min(g,m+e.clientY-d))+"px",t.current.style.height=Math.max(0,Math.min(p,u-e.clientY+d))+"px"):t.current.style.height=Math.max(0,Math.min(p,m+e.clientY-d))+"px")};(0,dom_utils_1.setCursor)(getComputedStyle(n.currentTarget).cursor);const v='div[class^="bh-resize-"]',N=()=>{window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",N),(0,dom_utils_1.releaseCursor)(),t.current?.querySelectorAll(v).forEach((e=>{e.style.cursor=e.getAttribute("data-cursor")}))};t.current.querySelectorAll(v).forEach((e=>{e.style.cursor="inherit"})),window.addEventListener("mouseup",N),window.addEventListener("mousemove",z)};return(0,react_1.useEffect)((()=>{const n="hidden"===t.current.style.visibility;if("maximize"===r);else{const a=t.current.getBoundingClientRect(),s=document.body.getBoundingClientRect(),r=Math.min(a.height,s.height),o=Math.min(a.width,s.width);t.current.style.height=r+"px",t.current.style.width=o+"px",n?(t.current.style.top=Math.max(0,Math.min(null!=e.top?a.top:s.height,(s.height-r)/2))+"px",t.current.style.left=Math.max(0,Math.min(null!=e.left?a.left:s.width,(s.width-o)/2))+"px"):(a.top+r>s.height&&(t.current.style.top=s.height-r+"px"),a.left+o>s.width&&(t.current.style.left=s.width-o+"px"))}n&&t.current.style.removeProperty("visibility")}),[r]),react_1.default.createElement(react_1.default.Fragment,null,!0===e.modal?react_1.default.createElement("div",{className:`${popup_1.PopupClassNames.m_p} ${exports.dialogWindowClassName}-mask`,style:{zIndex:1e8+5*a},tabIndex:0,onKeyDown:i}):react_1.default.createElement(react_1.default.Fragment,null),react_1.default.createElement("div",{ref:t,className:(0,classname_utils_1.className)("bh-popup",exports.dialogWindowClassName,!1===e.move||"maximize"===r?"":"bh-move","maximize"===r?"bh-max":""),style:{zIndex:1e8+5*a+2,visibility:"hidden",top:e.top,left:e.left,height:e.height,width:e.width},onClick:()=>{const n=getDialogWindowMaxZIndex(t.current?.parentElement)+1;n!==a&&s(e.setZIndex(n))}},react_1.default.createElement("div",{className:`${exports.dialogWindowClassName}-root`},!1===e.header?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${exports.dialogWindowClassName}-header`,onMouseDown:n=>{if(!1===e.move||"maximize"===r)return;const a=t.current.getBoundingClientRect(),s=a.left,o=a.top,i=n.clientX,l=n.clientY,d=document.body.getBoundingClientRect(),c=d.height-a.height,m=d.width-a.width,u=e=>{t.current.style.top=Math.max(0,Math.min(c,o+e.clientY-l))+"px",t.current.style.left=Math.max(0,Math.min(m,s+e.clientX-i))+"px"},h=()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",h),(0,dom_utils_1.releaseCursor)()};(0,dom_utils_1.setCursor)(getComputedStyle(n.currentTarget).cursor),window.addEventListener("mouseup",h),window.addEventListener("mousemove",u)},onDoubleClick:()=>{!1!==e.resize&&o((e=>"maximize"===e?"":"maximize"))}},react_1.default.createElement("div",{className:`${exports.dialogWindowClassName}-header-title`},e.title),!1===e.minimizeButton?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${exports.dialogWindowClassName}-header-minimize`,onClick:()=>e.dwc.hide(),onMouseDown:e=>e.stopPropagation()},react_1.default.createElement(icon_1.default,{image:"minus"})),!1===e.closeButton?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${exports.dialogWindowClassName}-header-close`,onClick:()=>e.dwc.close(),onMouseDown:e=>e.stopPropagation()},react_1.default.createElement(icon_1.default,{image:"close"}))),react_1.default.createElement("div",{className:`${exports.dialogWindowClassName}-body`},react_1.default.createElement("div",{className:`${style_1.scrollbarClassName} ${exports.dialogWindowClassName}-content`,style:e.contentStyle},react_1.default.createElement(e.component,{...e.props,ma:{_fetchMask:()=>n.current},dwc:e.dwc})),react_1.default.createElement("div",{ref:n,className:`${exports.dialogWindowClassName}-mask`}))),!1===e.resize||"maximize"===r?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{className:"bh-resize-lt",onMouseDown:e=>l(e,!0,!0,!0,!0)}),react_1.default.createElement("div",{className:"bh-resize-ct",onMouseDown:e=>l(e,!1,!1,!0,!0)}),react_1.default.createElement("div",{className:"bh-resize-rt",onMouseDown:e=>l(e,!0,!1,!0,!0)}),react_1.default.createElement("div",{className:"bh-resize-lm",onMouseDown:e=>l(e,!0,!0,!1,!1)}),react_1.default.createElement("div",{className:"bh-resize-rm",onMouseDown:e=>l(e,!0,!1,!1,!1)}),react_1.default.createElement("div",{className:"bh-resize-lb",onMouseDown:e=>l(e,!0,!0,!0,!1)}),react_1.default.createElement("div",{className:"bh-resize-cb",onMouseDown:e=>l(e,!1,!1,!0,!1)}),react_1.default.createElement("div",{className:"bh-resize-rb",onMouseDown:e=>l(e,!0,!1,!0,!1)}))),!0===e.modal?react_1.default.createElement("div",{className:`${popup_1.PopupClassNames.m_s} ${exports.dialogWindowClassName}-mask`,style:{zIndex:1e8+5*a+1},tabIndex:0,onKeyDown:i,onClick:()=>{switch(e.maskClickMode){case"close":e.dwc.close();break;case"hide":e.dwc.hide()}}}):react_1.default.createElement(react_1.default.Fragment,null),popup_1.PopupStyle,exports.DialogWindowStyle)};exports.DialogWindow=DialogWindow;const getDialogWindowMaxZIndex=e=>{let t=0;return document.querySelectorAll("body > div[data-name='bhDialogwindow']").forEach((n=>{n!==e&&(t=Math.max(t,Number(n.getAttribute("data-zindex")||"0")))})),t};exports.DialogWindowStyle=react_1.default.createElement(style_1.default,{id:exports.dialogWindowClassName,notDepsColor:!0,css:({design:e})=>`\n.${exports.dialogWindowClassName} {\n  box-sizing: border-box;\n  display: flex;\n  flex-flow: column nowrap;\n  justify-content: stretch;\n  align-items: stretch;\n  flex: none;\n  top: 0px;\n  left: 0px;\n  max-height: 100%;\n  max-width: 100%;\n  padding: ${resizeSize};\n  overflow: hidden;\n}\n.${exports.dialogWindowClassName}.bh-max {\n  height: 100% !important;\n  width: 100% !important;\n  top: 0px !important;\n  left: 0px !important;\n  padding: 0px;\n}\n.${exports.dialogWindowClassName}.bh-max > div[class^="bh-resize-"] {\n  display: none;\n}\n.${exports.dialogWindowClassName}-root {\n  ${style_1.CssPV.flex}\n  flex-flow: column nowrap;\n  justify-content: flex-start;\n  align-items: stretch;\n  ${style_1.CssPV.fill}\n  overflow: hidden;\n  background: ${style_1.CssVar.bg.c};\n}\n.${exports.dialogWindowClassName}-header {\n  ${style_1.CssPV.flex_r_r}\n  flex: none;\n  height: ${style_1.CssVar.size};\n  user-select: none;\n  z-index: 1;\n  overflow: hidden;\n}\n.${exports.dialogWindowClassName}.bh-move .${exports.dialogWindowClassName}-header {\n  cursor: move;\n}\n.${exports.dialogWindowClassName}-header-title {\n  ${style_1.CssPV.flex_r}\n  flex: 1;\n  padding: 2px 5px 0px 5px;\n  overflow: hidden;\n}\n.${exports.dialogWindowClassName}-header-close,\n.${exports.dialogWindowClassName}-header-minimize {\n  ${style_1.CssPV.flex_r_c}\n  flex: none;\n  cursor: pointer;\n}\n.${exports.dialogWindowClassName}-body {\n  ${style_1.CssPV.flex_c}\n  ${style_1.CssPV.f_y}\n  z-index: 0;\n}\n.${exports.dialogWindowClassName}-content {\n  ${style_1.CssPV.flex_c}\n  ${style_1.CssPV.fill}\n}\n.${exports.dialogWindowClassName} > div[class^="bh-resize-"]  {\n  background: transparent;\n  position: absolute;\n}\n.${exports.dialogWindowClassName} > .bh-resize-lt,\n.${exports.dialogWindowClassName} > .bh-resize-rb {\n  height: ${resizeSize};\n  width: ${resizeSize};\n  cursor: nwse-resize;\n}\n.${exports.dialogWindowClassName} > .bh-resize-lt {\n  top: 0px;\n  left: 0px;\n}\n.${exports.dialogWindowClassName} > .bh-resize-rb {\n  bottom: 0px;\n  right: 0px;\n}\n.${exports.dialogWindowClassName} > .bh-resize-rt,\n.${exports.dialogWindowClassName} > .bh-resize-lb {\n  height: ${resizeSize};\n  width: ${resizeSize};\n  cursor: nesw-resize;\n}\n.${exports.dialogWindowClassName} > .bh-resize-rt {\n  top: 0px;\n  right: 0px;\n}\n.${exports.dialogWindowClassName} > .bh-resize-lb {\n  bottom: 0px;\n  left: 0px;\n}\n.${exports.dialogWindowClassName} > .bh-resize-ct,\n.${exports.dialogWindowClassName} > .bh-resize-cb {\n  height: ${resizeSize};\n  width: calc(100% - ${resizeSize} * 2);\n  left: ${resizeSize};\n  cursor: ns-resize;\n}\n.${exports.dialogWindowClassName} > .bh-resize-ct {\n  top: 0px;\n}\n.${exports.dialogWindowClassName} > .bh-resize-cb {\n  bottom: 0px;\n}\n.${exports.dialogWindowClassName} > .bh-resize-lm,\n.${exports.dialogWindowClassName} > .bh-resize-rm {\n  height: calc(100% - ${resizeSize} * 2);\n  width: ${resizeSize};\n  top: ${resizeSize};\n  cursor: ew-resize;\n}\n.${exports.dialogWindowClassName} > .bh-resize-lm {\n  left: 0px;\n}\n.${exports.dialogWindowClassName} > .bh-resize-rm {\n  right: 0px;\n}\n.${exports.dialogWindowClassName}-mask {\n  z-index: 100000000;\n}\n${"material"===e?`\n.${exports.dialogWindowClassName}-root {\n  border: 1px solid ${style_1.CssVar.bdc};\n  border-radius: ${style_1.CssParam.m.r};\n}\n.${exports.dialogWindowClassName}-header {\n  box-shadow: ${style_1.CssParam.m.sdBtm};\n  border-bottom: 1px solid ${style_1.CssVar.bdc};\n  height: calc(${style_1.CssVar.size} + ${style_1.CssParam.m.sdPdd} * 2);\n  margin-bottom: ${style_1.CssParam.m.sdPdd};\n  background: ${style_1.CssVar.bg.c_h};\n}\n.${exports.dialogWindowClassName}-header-close,\n.${exports.dialogWindowClassName}-header-minimize {\n  background: ${style_1.CssVar.bg.c_h};\n  border: 1px solid transparent;\n  height: ${style_1.CssVar.size};\n  width: ${style_1.CssVar.size};\n  border-radius: ${style_1.CssParam.m.r};\n  margin-right: 5px;\n}\n.${exports.dialogWindowClassName}-header-close:hover,\n.${exports.dialogWindowClassName}-header-minimize:hover {\n  box-shadow: ${style_1.CssParam.m.sdBtm_f};\n  margin-top: calc(${style_1.CssParam.m.updownMargin} * -0.5);\n  margin-bottom: calc(${style_1.CssParam.m.updownMargin} * 0.5);\n  border-color: ${style_1.CssVar.bdc};\n}\n.${exports.dialogWindowClassName}-header-close:hover:active,\n.${exports.dialogWindowClassName}-header-minimize:hover:active {\n  box-shadow: none;\n  margin-top: calc(${style_1.CssParam.m.updownMargin} * 0.5);\n  margin-bottom: calc(${style_1.CssParam.m.updownMargin} * -0.5);\n}\n`:""}\n${"neumorphism"===e?`\n.${exports.dialogWindowClassName}-root {\n  border-radius: ${style_1.CssParam.n.r};\n  box-shadow: ${style_1.CssParam.n.border.cvxSd};\n}\n.${exports.dialogWindowClassName}-header {\n  height: calc(${style_1.CssVar.size} + ${style_1.CssParam.n.sdPdd} * 2);\n  padding: ${style_1.CssParam.n.sdPdd};\n  border-radius: ${style_1.CssParam.n.r};\n  margin: ${style_1.CssParam.n.accent.sdPdd};\n  box-shadow: ${style_1.CssParam.n.accent.cvxSd};\n  background: ${style_1.CssParam.n.headerCvxBg};\n}\n.${exports.dialogWindowClassName}-header-close,\n.${exports.dialogWindowClassName}-header-minimize {\n  height: ${style_1.CssVar.size};\n  width: ${style_1.CssVar.size};\n  border-radius: ${style_1.CssParam.n.r};\n  margin-right: 5px;\n}\n.${exports.dialogWindowClassName}-header-close:hover,\n.${exports.dialogWindowClassName}-header-minimize:hover {\n  box-shadow: ${style_1.CssParam.n.cvxSd_f};\n  background: ${style_1.CssParam.n.cvxBg};\n}\n.${exports.dialogWindowClassName}-header-close:hover:active,\n.${exports.dialogWindowClassName}-header-minimize:hover:active {\n  box-shadow: ${style_1.CssParam.n.ccvSd};\n  background: ${style_1.CssParam.n.ccvBg};\n  padding-top: 1.5px;\n}\n`:""}\n`});const useDialogWindow=(e,t)=>{const n=(0,react_1.useRef)(),a=(0,react_1.useRef)(!1),s=(0,react_1.useRef)(),r=(0,react_1.useRef)({closed:()=>{},hided:()=>{}}),o=(0,style_1.useLayout)(),i=(0,react_1.useCallback)((()=>{null!=n.current&&(n.current.style.display="none",n.current.removeAttribute("data-zindex"),r.current.hided?.(),a.current=!1)}),[]),l=(0,react_1.useCallback)((()=>{null!=n.current&&(react_dom_1.default.unmountComponentAtNode(n.current),n.current.removeAttribute("data-zindex"),r.current.closed?.(),a.current=!1)}),[]),d=(0,react_1.useCallback)((d=>{null==n.current&&(n.current=document.createElement("div"),n.current.setAttribute("data-name","bhDialogwindow"),document.body.appendChild(n.current));const c=getDialogWindowMaxZIndex(n.current)+1,m={close:l,hide:i};s.current=d,r.current.closed=d?.closed??t?.closed,r.current.hided=d?.hided??t?.hided;const u={...t,...d};react_dom_1.default.render(react_1.default.createElement(style_1.StyleContext.Provider,{value:o},react_1.default.createElement(exports.DialogWindow,{dwc:m,zIndex:c,component:e,props:{...t?.componentProps,...d?.componentProps},setZIndex:e=>(n.current.setAttribute("data-zindex",String(e)),e),contentStyle:{...t?.contentStyle,...d?.contentStyle},modal:u.modal,header:u.header,title:u.title,closeButton:u.closeButton,minimizeButton:u.minimizeButton,move:u.move,resize:u.resize,fullScreen:u.fullScreen,maskClickMode:u.maskClickMode,top:u.top,left:u.left,height:u.height,width:u.width})),n.current,(()=>{setTimeout((()=>{a.current=!0,n.current.setAttribute("data-zindex",String(c)),n.current.style.removeProperty("display")}),0)}))}),[o]);return(0,react_1.useEffect)((()=>{a.current&&d(s.current)}),[o]),(0,react_1.useEffect)((()=>()=>{null!=n.current&&(react_dom_1.default.unmountComponentAtNode(n.current),n.current?.parentElement.removeChild(n.current),n.current=null)}),[]),{show:d,close:l,hide:i}};exports.default=useDialogWindow;