"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PopupStyle=exports.PopupClassNames=exports.popupClassName=void 0;const string_utils_1=__importDefault(require("@bizhermit/basic-utils/dist/string-utils")),react_1=__importStar(require("react")),react_dom_1=__importDefault(require("react-dom")),style_1=__importStar(require("../layouts/style")),dom_utils_1=require("../utils/dom-utils"),prop_1=__importDefault(require("./prop"));exports.popupClassName="bh-popup",exports.PopupClassNames={b:exports.popupClassName,b_t:`${exports.popupClassName}-transparent`,m_p:`${exports.popupClassName}-mask-suffix`,m_s:`${exports.popupClassName}-mask-prefix`};const usePopup=(e,t)=>{const r=(0,react_1.useRef)(),o=(0,react_1.useRef)(!1),s=(0,react_1.useRef)(),p=(0,prop_1.default)((0,style_1.useLayout)()),n=(0,react_1.useCallback)((e=>{"Escape"===e.key&&i()}),[]),l=(0,react_1.useCallback)((e=>{e.stopPropagation()}),[]),a=(0,react_1.useCallback)((()=>{i()}),[]),i=(0,react_1.useCallback)((e=>{if(!o.current||null==r.current)return;const t=s.current?.();!1===t&&!0!==e||((0,dom_utils_1.setStyleProps)(r.current,{display:"none",visibility:"hidden"}),window.removeEventListener("click",a),window.removeEventListener("keydown",n),react_dom_1.default.unmountComponentAtNode(r.current),o.current=!1)}),[]);return(0,react_1.useEffect)((()=>()=>{try{if(null==r.current)return;i(!0),r.current.removeEventListener("click",l),r.current.parentElement?.removeChild(r.current),r.current=null}catch{}}),[]),(0,react_1.useMemo)((()=>({hide:i,show:(i,u)=>{setTimeout((()=>{null==r.current&&(r.current=(()=>{const e=document.createElement("div");return(0,dom_utils_1.setStyleProps)(e,{display:"none",visibility:"hidden"}),e.classList.add(!0===t?.transparent?exports.PopupClassNames.b_t:exports.PopupClassNames.b),string_utils_1.default.isNotNullOrEmpty(t?.className)&&e.classList.add(t.className),e.addEventListener("click",l),document.body.appendChild(e),e})()),(0,dom_utils_1.setStyleProps)(r.current,{display:null}),u?.createMountElementCallback?.(r.current),s.current=u?.hideCallback??t?.hideCallback,react_dom_1.default.render(react_1.default.createElement(style_1.StyleContext.Provider,{value:p.current},react_1.default.createElement(e,{...u?.componentProps}),exports.PopupStyle),r.current,(()=>{popup(i,r.current,u?.position),(0,dom_utils_1.setStyleProps)(r.current,{visibility:null}),window.addEventListener("click",a),window.addEventListener("keydown",n),o.current=!0,u?.showedCallback?.()}))}),0)},getElement:()=>r.current,isShowed:()=>o.current})),[])};exports.default=usePopup;const popup=(e,t,r)=>{if(null==e||null==t)return null;const o=e.getBoundingClientRect(),s=document.body.clientWidth,p=document.body.clientHeight,n=t.offsetWidth,l=t.offsetHeight;switch(r?.x){case"outer":s-o.right-1>n||s-o.right>o.left?(t.style.left=`${o.right}px`,t.style.removeProperty("right")):(t.style.right=s-o.left+"px",t.style.removeProperty("left"));break;case"outer-left":t.style.right=s-o.left+"px",t.style.removeProperty("left");break;case"outer-right":t.style.left=`${o.right}px`,t.style.removeProperty("right");break;case"inner-left":t.style.left=`${o.left}px`,t.style.removeProperty("right");break;case"inner-right":t.style.right=s-o.right+"px",t.style.removeProperty("left");break;default:s-o.left-1>n||s-o.left>o.right?(t.style.left=`${o.left}px`,t.style.removeProperty("right")):(t.style.right=s-o.right+"px",t.style.removeProperty("left"))}switch(r?.y){case"inner":p-o.top-1>l&&p-o.bottom>p-o.top?(t.style.top=`${o.top}px`,t.style.removeProperty("bottom")):(t.style.bottom=p-o.bottom+"px",t.style.removeProperty("top"));break;case"inner-top":t.style.top=`${o.top}px`,t.style.removeProperty("bottom");break;case"inner-bottom":t.style.bottom=p-o.bottom+"px",t.style.removeProperty("top");break;case"outer-top":t.style.bottom=p-o.top+"px",t.style.removeProperty("top");break;case"outer-bottom":t.style.top=`${o.bottom}px`,t.style.removeProperty("bottom");break;default:p-o.bottom-1>l||p-o.bottom>o.top?(t.style.top=`${o.bottom}px`,t.style.removeProperty("bottom")):(t.style.bottom=p-o.top+"px",t.style.removeProperty("top"))}};exports.PopupStyle=react_1.default.createElement(style_1.default,{id:exports.popupClassName,notDepsColor:!0,css:({design:e})=>`\n.${exports.PopupClassNames.b},\n.${exports.PopupClassNames.b_t} {\n  box-sizing: border-box;\n  z-index: 1000000000;\n  position: fixed;\n}\n.${exports.PopupClassNames.m_p},\n.${exports.PopupClassNames.m_s} {\n  box-sizing: border-box !important;\n  position: absolute !important;\n  top: 0px !important;\n  left: 0px !important;\n  height: 100% !important;\n  width: 100% !important;\n  max-height: 100% !important;\n  max-width: 100% !important;\n  min-height: 100% !important;\n  min-width: 100% !important;\n  outline: none;\n  background: ${style_1.CssVar.mask.bg};\n}\n.${exports.PopupClassNames.m_s} {\n  opacity: 0;\n}\n${"material"===e?`\n.${exports.PopupClassNames.b} {\n  filter: drop-shadow(0px 8px 5px ${style_1.CssVar.shadow.dc});\n}\n.${exports.PopupClassNames.b_t} {\n  box-shadow: 0px 8px 5px ${style_1.CssVar.shadow.dc};\n}\n`:""}\n${"neumorphism"===e?`\n.${exports.PopupClassNames.b} {\n  filter: drop-shadow(0px 8px 5px ${style_1.CssVar.shadow.dc});\n}\n.${exports.PopupClassNames.b_t} {\n  box-shadow: 0px 8px 5px ${style_1.CssVar.shadow.dc};\n}\n`:""}\n`});