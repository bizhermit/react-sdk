"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,r){void 0===r&&(r=a),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,r){void 0===r&&(r=a),e[r]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DatePickerStyle=exports.datePickerClassName=void 0;const datetime_utils_1=__importDefault(require("@bizhermit/basic-utils/dist/datetime-utils")),react_1=__importStar(require("react")),icon_1=__importDefault(require("../graphics/icon")),controller_1=require("../hooks/controller"),prop_1=__importDefault(require("../hooks/prop")),value_1=__importDefault(require("../hooks/value")),input_1=__importStar(require("../layouts/input")),style_1=__importStar(require("../layouts/style")),classname_utils_1=require("../utils/classname-utils");exports.datePickerClassName="bh-dtp";const listPrefix=`.${exports.datePickerClassName}-main[data-ui="list"]`,calPrefix=`.${exports.datePickerClassName}-main[data-ui="calendar"]`,monthTextsNum=["1","2","3","4","5","6","7","8","9","10","11","12"],monthTextsJa=["１月","２月","３月","４月","５月","６月","７月","８月","９月","１０月","１１月","１２月"],monthTextsEn=["January","Feburary","March","April","May","Jun","July","August","September","October","November","December"],monthTextsEnS=["Jan.","Feb.","Mar.","Apr.","May","Jun","Jul.","Aug.","Sep.","Oct.","Nov.","Dec."],weekTextsJa=["日","月","火","水","木","金","土"],weekTextsEn=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],DatePicker=e=>{const t=(0,react_1.useRef)(),a=(0,react_1.useRef)(),r=(0,react_1.useRef)(),s=(0,react_1.useRef)(),l=(0,prop_1.default)(e.mode??"ymd"),n=(0,prop_1.default)(!0===e.disabled),[c,i]=(0,react_1.useState)((()=>"y"===l.current||"ym"===l.current?"list":e.uiType??"calendar")),{getValue:o,setValue:d}=(0,value_1.default)(e,{binded:e=>{S(e),g(),h()}}),u=(0,react_1.useRef)((()=>{const t=datetime_utils_1.default.resetTime(e.rangeFrom??new Date),a=o();if(null!=a){let e=null;e="string"==typeof a||"number"==typeof a?datetime_utils_1.default.convertStringToDate(String(a)):a,t.setDate(e.getDate()),t.setMonth(e.getMonth()),t.setFullYear(e.getFullYear())}return"ymd"!==l.current&&t.setDate(1),"y"===l.current&&t.setMonth(0),t})()),m=(0,react_1.useRef)((()=>{const e=datetime_utils_1.default.resetTime(new Date);return e.setFullYear(u.current.getFullYear()),e.setMonth(u.current.getMonth()),e.setDate(u.current.getDate()),e})()),[p,x]=(0,react_1.useState)((()=>m.current.getFullYear())),[_,f]=(0,react_1.useState)((()=>m.current.getMonth())),[C,P]=(0,react_1.useState)((()=>m.current.getDate())),k=(0,react_1.useMemo)((()=>null==e.monthTexts||"num"===e.monthTexts?monthTextsNum:"en"===e.monthTexts?monthTextsEn:"en-s"===e.monthTexts?monthTextsEnS:"ja"===e.monthTexts?monthTextsJa:12!==e.monthTexts.length?monthTextsNum:e.monthTexts),[e.monthTexts]),$=(0,react_1.useMemo)((()=>null==e.weekTexts||"ja"===e.weekTexts?weekTextsJa:"en"===e.weekTexts?weekTextsEn:7!==e.weekTexts.length?weekTextsJa:e.weekTexts),[e.weekTexts]),g=(0,react_1.useCallback)((()=>{u.current.setFullYear(m.current.getFullYear()),u.current.setMonth(m.current.getMonth()),u.current.setDate(m.current.getDate())}),[]),h=(0,react_1.useCallback)((()=>{x(m.current.getFullYear()),f(m.current.getMonth()),P(m.current.getDate()),e.clickCell?.(m.current)}),[]),y=(0,react_1.useCallback)(((e,t)=>{if(n.current&&!0!==t)return;let a=e.m??m.current.getMonth();a<0?a=(12+a)%12:a>11&&(a%=12),m.current.setFullYear(e.y),m.current.getMonth()!==a&&m.current.setDate(0),!0!==t&&g(),h()}),[]),{yearCellNodes:N,yearPos:b}=(0,react_1.useMemo)((()=>{const t=[];let a=0;const r=e.rangeFrom?.getFullYear()??1980;for(let s=r,l=e.rangeTo?.getFullYear()??2100;s<l;s++)t.push(react_1.default.createElement(DatePickerCell,{key:s,click:y,data:{y:s},selected:s===p},s)),s===p&&(a=s-r);return{yearCellNodes:t,yearPos:a}}),[p]),w=(0,react_1.useCallback)(((e,t)=>{if(n.current&&!0!==t)return;m.current.setFullYear(e.y),m.current.setMonth(e.m);let a=e.m;a<0?a=(12+a)%12:a>11&&(a%=12),m.current.getMonth()!==a&&m.current.setDate(0),!0!==t&&g(),h()}),[]),{monthCellNodes:v,monthPos:D}=(0,react_1.useMemo)((()=>{const e=[];let t=0;for(let a=0,r=12;a<r;a++)e.push(react_1.default.createElement(DatePickerCell,{key:a,click:w,data:{y:p,m:a},selected:a===_},k[a])),a===_&&(t=a);return{monthCellNodes:e,monthPos:t}}),[p,_]),M=(0,react_1.useCallback)((e=>{n.current||(m.current.setFullYear(e.y),m.current.setMonth(e.m),m.current.setDate(e.d),g(),h())}),[]),{dateCellNodes:E,datePos:T}=(0,react_1.useMemo)((()=>{const t=[];let a=0,r=new Date(p,_+1,0);const s=r.getDate();r.setDate(1),r.setMonth(_),r.setFullYear(p);const l=r.getDay();if("calendar"===c){const a=e.startWeek??0;r.setDate(0);const s=r.getDate(),n=r.getFullYear(),c=r.getMonth();let i=(l-a+7)%7||7;i<2&&(i+=7);for(let e=0,r=i;e<r;e++)t.push(react_1.default.createElement(DatePickerCell,{key:`-${e}`,click:M,data:{y:n,m:c,d:s-i+e+1},selected:!1,weekNum:(a+e)%7,ym:"before"},s-i+e+1))}const n=p===u.current.getFullYear()&&_===u.current.getMonth(),i=u.current.getDate(),o=new Date;for(let e=0,r=s;e<r;e++){const r=i===e+1&&n;t.push(react_1.default.createElement(DatePickerCell,{key:e,click:M,data:{y:p,m:_,d:e+1},selected:r,weekNum:(l+e)%7,today:e+1===o.getDate()&&_===o.getMonth()&&p===o.getFullYear()},e+1)),e+1===C&&(a=e)}if("calendar"===c){r=new Date(p,_+1,1);const e=r.getDay(),a=r.getFullYear(),s=r.getMonth();let l=7-t.length%7;l<5&&(l+=7);for(let r=0,n=l;r<n;r++)t.push(react_1.default.createElement(DatePickerCell,{key:`+${r}`,click:M,data:{y:a,m:s,d:r+1},selected:!1,weekNum:(e+r)%7,ym:"after"},r+1))}return{dateCellNodes:t,datePos:a}}),[p,_,C,c,e.startWeek]),F=(0,react_1.useMemo)((()=>{const t=[];for(let a=0;a<7;a++){const r=(a+(e.startWeek??0))%7;t.push(react_1.default.createElement(DatePickerCell,{key:r,click:()=>{},data:{},selected:!1,weekNum:r},$[r]))}return t}),[$,e.startWeek]),S=e=>{let t=null;t="string"==typeof e||"number"==typeof e?datetime_utils_1.default.convertStringToDate(String(e)):e??new Date,u.current.setDate(t.getDate()),u.current.setMonth(t.getMonth()),u.current.setFullYear(t.getFullYear()),m.current.setDate(t.getDate()),m.current.setMonth(t.getMonth()),m.current.setFullYear(t.getFullYear())};return(0,controller_1.initController)(e.controller,(e=>{e.focus=()=>(t.current?.focus(),e),e.blur=()=>(t.current?.blur(),e),e.getValue=()=>o(),e.setValue=t=>(S(t),e)})),(0,react_1.useEffect)((()=>{"ymd"!==l.current&&"calendar"===c&&i("list")}),[e.mode]),(0,react_1.useEffect)((()=>{if("list"===c){const e=`.${exports.datePickerClassName}-cell`;let t=a.current.querySelector(e).getBoundingClientRect();a.current.scrollTop=t.height*b-(a.current.clientHeight-t.height)/2,"y"!==l.current&&(t=r.current.querySelector(e).getBoundingClientRect(),r.current.scrollTop=t.height*D-(r.current.clientHeight-t.height)/2),"ymd"===l.current&&(t=s.current.querySelector(e).getBoundingClientRect(),s.current.scrollTop=t.height*T-(s.current.clientHeight-t.height)/2)}}),[c]),react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{ref:t,style:e.style,className:(0,classname_utils_1.className)(exports.datePickerClassName,e.className),"data-disabled":!0===e.disabled,"data-required":e.required,"data-mode":l.current},react_1.default.createElement("div",{className:`${exports.datePickerClassName}-main`,"data-ui":c},react_1.default.createElement("div",{ref:a,className:`${style_1.scrollbarClassName} ${exports.datePickerClassName}-year`},"list"===c?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${input_1.InputClassNames.btn_o} ${exports.datePickerClassName}-icon-button`,onClick:()=>y({y:p-1,m:_},!0)},react_1.default.createElement(icon_1.default,{image:"pullleft"})),N,"list"===c?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${input_1.InputClassNames.btn_o} ${exports.datePickerClassName}-icon-button`,onClick:()=>y({y:p+1,m:_},!0)},react_1.default.createElement(icon_1.default,{image:"pullright"}))),"y"===l.current?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{ref:r,className:`${style_1.scrollbarClassName} ${exports.datePickerClassName}-month`},"list"===c?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${input_1.InputClassNames.btn_o} ${exports.datePickerClassName}-icon-button`,onClick:()=>w({y:p,m:_-1},!0)},react_1.default.createElement(icon_1.default,{image:"pullleft"})),v,"list"===c?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${input_1.InputClassNames.btn_o} ${exports.datePickerClassName}-icon-button`,onClick:()=>w({y:p,m:_+1},!0)},react_1.default.createElement(icon_1.default,{image:"pullright"})))),"ymd"===l.current?react_1.default.createElement(react_1.default.Fragment,null,"list"===c?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${exports.datePickerClassName}-week`},F),react_1.default.createElement("div",{ref:s,className:`${style_1.scrollbarClassName} ${exports.datePickerClassName}-date`},E)):react_1.default.createElement(react_1.default.Fragment,null)),!0===e.disabled?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement("div",{className:`${exports.datePickerClassName}-buttons`},react_1.default.createElement("div",{className:`${input_1.InputClassNames.btn_l} ${exports.datePickerClassName}-button`,onClick:()=>{const t=o();let a=new Date;null!=t&&(a="string"==typeof t||"number"==typeof t?datetime_utils_1.default.convertStringToDate(String(t)):t),m.current.setFullYear(a.getFullYear()),m.current.setMonth(a.getMonth()),m.current.setDate(a.getDate()),g(),x(m.current.getFullYear()),f(m.current.getMonth()),P(m.current.getDate()),e.clickNegative?.()},tabIndex:-1},e.negativeButtonLabel??"キャンセル"),react_1.default.createElement("div",{className:`${"ymd"===l.current?input_1.InputClassNames.btn_bt:input_1.InputClassNames.btn} ${exports.datePickerClassName}-button`,onClick:()=>{switch(e.dataType){case"date":d(new Date(u.current));break;case"number":const t=datetime_utils_1.default.convertDateToString(u.current,"yyyyMMdd");d(""===t?null:Number(t));break;default:d(datetime_utils_1.default.convertDateToString(u.current,e.format??"yyyyMMdd"))}e.clickPositive&&setTimeout((()=>{const t=new Date(u.current);e.clickPositive(t)}),0)},tabIndex:-1},e.positiveButtonLabel??"OK"),"ymd"===l.current?react_1.default.createElement("div",{className:`${input_1.InputClassNames.btn} ${exports.datePickerClassName}-icon-button`,onClick:()=>i((e=>"list"===e?"calendar":"list"))},react_1.default.createElement(icon_1.default,{image:"list"===c?"calendar":"list"})):react_1.default.createElement(react_1.default.Fragment,null))),input_1.default,exports.DatePickerStyle)};exports.default=DatePicker;const DatePickerCell=e=>react_1.default.createElement("div",{className:`${exports.datePickerClassName}-cell`,onClick:()=>e.click(e.data),"data-selected":e.selected,"data-week":e.weekNum??"","data-ym":e.ym??"current","data-today":!0===e.today},e.children);exports.DatePickerStyle=react_1.default.createElement(style_1.default,{id:exports.datePickerClassName,notDepsColor:!0,css:({design:e})=>`\n.${exports.datePickerClassName} {\n  ${style_1.CssPV.flex_c}\n  flex: none;\n  overflow: hidden;\n  height: calc(${style_1.CssVar.size} * 9);\n  user-select: none;\n}\n.${exports.datePickerClassName}[data-mode="ymd"] {\n  width: calc(${style_1.CssVar.size} * 8);\n}\n.${exports.datePickerClassName}[data-mode="ym"] {\n  width: calc(${style_1.CssVar.size} * 7);\n}\n.${exports.datePickerClassName}[data-mode="y"] {\n  width: calc(${style_1.CssVar.size} * 6);\n}\n.${exports.datePickerClassName}-main {\n  box-sizing: border-box;\n  position: relative;\n  overflow: visible;\n  flex: 1;\n  width: 100%;\n  min-height: 0px;\n  display: flex;\n  flex-wrap: nowrap;\n  justify-content: flex-start;\n  align-items: flex-start;\n}\n.${exports.datePickerClassName}-year,\n.${exports.datePickerClassName}-month,\n.${exports.datePickerClassName}-week,\n.${exports.datePickerClassName}-date {\n  box-sizing: border-box;\n  position: relative;\n  display: flex;\n}\n.${exports.datePickerClassName}-cell {\n  box-sizing: border-box;\n  position: relative;\n  user-select: none;\n  white-space: nowrap;\n  display: flex;\n  flex-flow: row nowrap;\n  justify-content: center;\n  align-items: center;\n  padding: 2px 0px 0px 0px;\n  z-index: 0;\n}\n.${exports.datePickerClassName}-cell:hover {\n  z-index: 1;\n}\n${listPrefix} {\n  flex-direction: row;\n}\n${listPrefix} > div {\n  flex: 1;\n  height: 100%;\n  min-width: 0px;\n  flex-flow: column nowrap;\n}\n${listPrefix} .${exports.datePickerClassName}-cell {\n  height: ${style_1.CssVar.size};\n  width: 100%;\n  flex: none;\n}\n${calPrefix} {\n  flex-direction: column;\n}\n${calPrefix} .${exports.datePickerClassName}-year,\n${calPrefix} .${exports.datePickerClassName}-month,\n${calPrefix} .${exports.datePickerClassName}-week {\n  flex: none;\n  overflow: hidden;\n  width: 100%;\n  flex-flow: row nowrap;\n  justify-content: flex-start;\n  align-items: center;\n  height: ${style_1.CssVar.size};\n  overflow: visible;\n}\n${calPrefix} .${exports.datePickerClassName}-week {\n  height: calc(${style_1.CssVar.size} * 0.8);\n}\n${calPrefix} .${exports.datePickerClassName}-date {\n  flex: 1;\n  min-height: 0px;\n  flex-flow: row wrap;\n  overflow: visible;\n  width: 100%;\n}\n${calPrefix} .${exports.datePickerClassName}-year .${exports.datePickerClassName}-cell,\n${calPrefix} .${exports.datePickerClassName}-month .${exports.datePickerClassName}-cell {\n  flex: 1;\n}\n${calPrefix} .${exports.datePickerClassName}-year .${exports.datePickerClassName}-cell[data-selected="false"],\n${calPrefix} .${exports.datePickerClassName}-month .${exports.datePickerClassName}-cell[data-selected="false"] {\n  display: none;\n}\n${calPrefix} .${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell {\n  height: 16.666%;\n  width: 14.285%;\n}\n${calPrefix} .${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell[data-ym="before"],\n${calPrefix} .${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell[data-ym="after"] {\n  opacity: 0.6;\n}\n.${exports.datePickerClassName}[data-disabled="false"] ${listPrefix} .${exports.datePickerClassName}-cell,\n.${exports.datePickerClassName}[data-disabled="false"] .${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell {\n  cursor: pointer;\n}\n.${exports.datePickerClassName}-week .${exports.datePickerClassName}-cell {\n  flex: 1;\n  font-size: 70%;\n}\n.${exports.datePickerClassName}-week .${exports.datePickerClassName}-cell[data-week="0"] {\n  background: ${style_1.CssVar.w_sun.bg};\n}\n.${exports.datePickerClassName}-week .${exports.datePickerClassName}-cell[data-week="6"] {\n  background: ${style_1.CssVar.w_sat.bg};\n}\n.${exports.datePickerClassName}-cell[data-today="true"] {\n  text-decoration: underline;\n}\n.${exports.datePickerClassName}-buttons {\n  ${style_1.CssPV.flex_r_c}\n  flex: none;\n  width: 100%;\n  overflow: visible;\n}\n.${exports.datePickerClassName}-button,\n.${exports.datePickerClassName}-icon-button {\n  ${style_1.CssPV.flex_r_c}\n  cursor: pointer;\n}\n.${exports.datePickerClassName}-button {\n  flex: 1;\n  min-width: 0px;\n  padding-top: 2px;\n  height: ${style_1.CssVar.size};\n}\n.${exports.datePickerClassName}-icon-button {\n  flex: none;\n  height: ${style_1.CssVar.size};\n  width: ${style_1.CssVar.size};\n}\n${"material"===e?`\n.${exports.datePickerClassName} {\n  border: 1px solid ${style_1.CssVar.bdc};\n  border-radius: ${style_1.CssParam.m.r};\n  padding: ${style_1.CssParam.m.r};\n  background: ${style_1.CssVar.bg.c};\n}\n${listPrefix} > div {\n  padding: ${style_1.CssParam.m.sdPdd};\n}\n.${exports.datePickerClassName}-week .${exports.datePickerClassName}-cell:first-child {\n  border-top-left-radius: ${style_1.CssParam.m.r};\n  border-bottom-left-radius: ${style_1.CssParam.m.r};\n}\n.${exports.datePickerClassName}-week .${exports.datePickerClassName}-cell:last-child {\n  border-top-right-radius: ${style_1.CssParam.m.r};\n  border-bottom-right-radius: ${style_1.CssParam.m.r};\n}\n${listPrefix} .${exports.datePickerClassName}-cell,\n.${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell {\n  border-radius: ${style_1.CssParam.m.r};\n  border: 1px solid transparent;\n}\n\n${listPrefix} .${exports.datePickerClassName}-cell:hover,\n.${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell:hover {\n  margin-top: -${style_1.CssParam.m.updownMargin};\n  margin-bottom: ${style_1.CssParam.m.updownMargin};\n  box-shadow: ${style_1.CssParam.m.sdBtm_f};\n  border-color: ${style_1.CssVar.bdc};\n}\n${listPrefix} .${exports.datePickerClassName}-cell:hover:active,\n.${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell:hover:active {\n  margin-top: 0px; \n  margin-bottom: 0px;\n  box-shadow: none;\n}\n${listPrefix} .${exports.datePickerClassName}-cell[data-selected="true"],\n.${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell[data-selected="true"] {\n  background: ${style_1.CssVar.bg.c_a};\n  border-color: transparent;\n  box-shadow: none;\n  margin-top: 0px;\n  margin-bottom: 0px;\n}\n.${exports.datePickerClassName}-buttons {\n  margin-top: ${style_1.CssParam.m.updownMargin};\n}\n`:""}\n${"neumorphism"===e?`\n.${exports.datePickerClassName} {\n  padding: ${style_1.CssParam.n.sdPdd};\n  box-shadow: ${style_1.CssParam.n.border.cvxSd};\n  background: ${style_1.CssParam.n.cvxBg};\n  border-radius: ${style_1.CssParam.n.r};\n}\n${listPrefix} > div {\n  padding: ${style_1.CssParam.n.sdPdd};\n}\n.${exports.datePickerClassName}-week .${exports.datePickerClassName}-cell:first-child {\n  border-top-left-radius: ${style_1.CssParam.n.r};\n  border-bottom-left-radius: ${style_1.CssParam.n.r};\n}\n.${exports.datePickerClassName}-week .${exports.datePickerClassName}-cell:last-child {\n  border-top-right-radius: ${style_1.CssParam.n.r};\n  border-bottom-right-radius: ${style_1.CssParam.n.r};\n}\n${listPrefix} .${exports.datePickerClassName}-cell,\n.${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell {\n  border-radius: ${style_1.CssParam.n.r};\n}\n${listPrefix} .${exports.datePickerClassName}-cell:hover,\n.${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell:hover {\n  box-shadow: ${style_1.CssParam.n.cvxSd};\n  background: ${style_1.CssParam.n.cvxBg};\n}\n${listPrefix} .${exports.datePickerClassName}-cell:hover:active,\n.${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell:hover:active {\n  box-shadow: ${style_1.CssParam.n.ccvSd};\n  background: ${style_1.CssParam.n.ccvBg};\n  padding-top: 4px;\n}\n${listPrefix} .${exports.datePickerClassName}-cell[data-selected="true"],\n.${exports.datePickerClassName}-date .${exports.datePickerClassName}-cell[data-selected="true"] {\n  box-shadow: ${style_1.CssParam.n.ccvSd};\n  background: ${style_1.CssParam.n.accent.ccvBg};\n}\n.${exports.datePickerClassName}-buttons {\n  margin-top: ${style_1.CssParam.n.ccvSdPdd};\n}\n.${exports.datePickerClassName}-month {\n  margin-top: ${style_1.CssParam.n.ccvSdPdd};\n}\n`:""}\n`});