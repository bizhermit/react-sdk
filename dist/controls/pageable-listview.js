"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,s){void 0===s&&(s=a),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,s){void 0===s&&(s=a),e[s]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PageableListViewStyle=exports.pageableListViewClassName=void 0;const react_1=__importStar(require("react")),controller_1=require("../hooks/controller"),style_1=__importStar(require("../layouts/style")),classname_utils_1=__importDefault(require("../utils/classname-utils")),listview_1=__importStar(require("./listview")),selectbox_1=__importDefault(require("./selectbox"));exports.pageableListViewClassName="bh-plv";const PageableListView=e=>{const t=(0,react_1.useRef)(),[a,s]=(0,react_1.useState)([]),[r,l]=(0,react_1.useState)([]),n=(0,react_1.useRef)(0),[i,o]=(0,react_1.useState)(n.current),c=(0,react_1.useRef)(e.pageOptions?.recordsPerPage??10),{prevPageNodes:u,nextPageNodes:p}=(0,react_1.useMemo)((()=>{const t=[],s=[],r=null==e.pageOptions?.overridePageStatus?Math.ceil(a.length/c.current):e.pageOptions.overridePageStatus.maxPage;for(let e=0,a=Math.min(r,i);e<a;e++)t.push(react_1.default.createElement(ListViewPageNumber,{key:e,click:()=>_(e)},e+1));for(let e=i+1;e<r;e<e++)s.push(react_1.default.createElement(ListViewPageNumber,{key:e,click:()=>_(e)},e+1));return{prevPageNodes:t,nextPageNodes:s}}),[i,a,e.pageOptions?.overridePageStatus]),g=(0,react_1.useMemo)((()=>{const t=[],s=null==e.pageOptions?.overridePageStatus?Math.ceil(a.length/c.current):e.pageOptions.overridePageStatus.maxPage;for(let e=0;e<s;e++)t.push({value:e,label:String(e+1)});return t}),[a.length,e.pageOptions?.overridePageStatus]),d=(0,react_1.useMemo)((()=>({page:i})),[i]),_=t=>{null==e.pageOptions?.overridePageStatus&&o(n.current=t),e.pageOptions?.changedPage?.(t)};(0,react_1.useEffect)((()=>{const t=e.value??[];if(null==e.pageOptions?.overridePageStatus){const e=c.current*i;l(t.slice(e,e+c.current))}else l(t)}),[a,i]),(0,react_1.useEffect)((()=>{s(e.value??[])}),[e.value]),(0,react_1.useEffect)((()=>{null!=e.pageOptions?.overridePageStatus&&o(n.current=e.pageOptions.overridePageStatus.pageIndex)}),[e.pageOptions?.overridePageStatus]),(0,controller_1.initController)(e.controller,(e=>{e.getPageIndex=()=>n.current,e.getPageNumber=()=>n.current+1}));const m=Math.max(2*(0,style_1.cssParamsSize)(),20*String(g.length).length+(0,style_1.cssParamsSize)());return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{ref:t,style:e.style,className:classname_utils_1.default.join(exports.pageableListViewClassName,e.className)},"bottom"===e.pageOptions?.pageNumberPosition?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{className:`${exports.pageableListViewClassName}-page-control`},react_1.default.createElement("div",{className:`${exports.pageableListViewClassName}-page-prev`},u),react_1.default.createElement(selectbox_1.default,{style:{width:m},name:"page",bind:d,defaultValue:0,source:g,textAlign:"center",changed:e=>{_(Number(e?.value??0))},resize:!1}),react_1.default.createElement("div",{className:`${exports.pageableListViewClassName}-page-next`},p))),react_1.default.createElement(listview_1.default,{value:r,columns:e.columns,options:{...e.options,externalSort:!0,sorted:(t,s,r)=>{if(null==e.pageOptions?.overridePageStatus){const e=a.concat();if(""!==s)if("function"==typeof r.sort)e.sort(r.sort(s));else if(!1!==r.sort){const a="asc"===s?1:-1;"number"===r.dataType?e.sort(((e,s)=>Number(e[t])>Number(s[t])?a:-a)):e.sort(((e,s)=>e[t]>s[t]?a:-a))}const n=c.current*i;l(e.slice(n,n+c.current))}e.options?.sorted&&e.options.sorted(t,s,r)}}}),"top"===e.pageOptions?.pageNumberPosition?react_1.default.createElement(react_1.default.Fragment,null):react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("div",{className:`${exports.pageableListViewClassName}-page-control`},react_1.default.createElement("div",{className:`${exports.pageableListViewClassName}-page-prev`},u),react_1.default.createElement(selectbox_1.default,{style:{width:m},name:"page",bind:d,defaultValue:0,source:g,textAlign:"center",changed:e=>{_(Number(e?.value??0))},resize:!1}),react_1.default.createElement("div",{className:`${exports.pageableListViewClassName}-page-next`},p)))),exports.PageableListViewStyle)};exports.default=PageableListView;const ListViewPageNumber=({click:e,children:t})=>react_1.default.createElement("div",{className:`bh-anchor ${exports.pageableListViewClassName}-page-number`,onClick:e},t);exports.PageableListViewStyle=react_1.default.createElement(style_1.default,{id:exports.pageableListViewClassName,notDepsColor:!0,notDepsDesign:!0,css:()=>`\n.${exports.pageableListViewClassName} {\n  ${style_1.CssPV.flex_c}\n  flex: none;\n  overflow: hidden;\n}\n.${exports.pageableListViewClassName}-page-control {\n  ${style_1.CssPV.flex_r_c}\n  flex: none;\n  width: 100%;\n}\n.${exports.pageableListViewClassName}-page-prev,\n.${exports.pageableListViewClassName}-page-next {\n  ${style_1.CssPV.flex_r}\n  flex: 1;\n  overflow: hidden;\n}\n.${exports.pageableListViewClassName}-page-prev {\n  justify-content: flex-end;\n}\n.${exports.pageableListViewClassName}-page-next {\n  justify-content: flex-start;\n}\n.${exports.pageableListViewClassName}-page-number {\n  ${style_1.CssPV.flex_r_c}\n  flex: none;\n  min-width: 30px;\n  user-select: none;\n  padding: 2px 3px 0px 3px;\n}\n.${exports.pageableListViewClassName} > .${listview_1.listViewClassName}-wrap {\n  width: 100%;\n  min-height: 0px;\n  flex: 1;\n}\n`});