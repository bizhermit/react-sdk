"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,a,l){void 0===l&&(l=a),Object.defineProperty(e,l,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,l){void 0===l&&(l=a),e[l]=t[a]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&__createBinding(t,e,a);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ListViewDateBoxColumnStyle=exports.listViewDateBoxColumnClassName=void 0;const datetime_utils_1=__importDefault(require("@bizhermit/basic-utils/dist/datetime-utils")),react_1=__importStar(require("react")),react_dom_1=__importDefault(require("react-dom")),controller_1=__importDefault(require("../../hooks/controller")),input_column_1=__importStar(require("../../layouts/input-column")),style_1=__importStar(require("../../layouts/style")),datebox_1=__importDefault(require("../datebox")),listview_1=require("../listview");exports.listViewDateBoxColumnClassName="bh-lv_c-dtb";const ListViewDateBoxColumn=e=>{const t=e.labelDataName??`_lbl_${e.name}`,a=null==e.labelFormat?e=>datetime_utils_1.default.convertDateToString(e,"yyyy/MM/dd"):"string"==typeof e.labelFormat?t=>datetime_utils_1.default.convertDateToString(t,e.labelFormat):e.labelFormat,l=e=>a("string"==typeof e?datetime_utils_1.default.convertStringToDate(e):"number"==typeof e?datetime_utils_1.default.convertStringToDate(String(e)):e);let i={value:null};return{...e,name:t,width:e.width??150,cellTextAlign:e.cellTextAlign??"center",initialize:()=>(0,listview_1.createListViewEditColumnElement)(),cellInitialize:(e,t)=>{e.element.classList.add(input_column_1.listViewInputColumnClassName,exports.listViewDateBoxColumnClassName);const a=(0,listview_1.cloneListViewEditColumnElement)(t);a.wrapElem.appendChild(a.lblElem),e.element.appendChild(a.wrapElem),e.contentElements.push(a.lblElem)},bindedItems:a=>{a.forEach((a=>a[t]=l(a[e.name])))},_beginEdit:({target:a,editElement:l,styleCtx:n})=>{!0!==e.disabled&&react_dom_1.default.render(react_1.default.createElement(style_1.StyleContext.Provider,{value:n},react_1.default.createElement(DateBoxColumn,{bind:i={value:a.data[e.name]??null},options:e.dateBoxOptions})),l,(()=>{e.beganEdit?.({value:a.data[e.name],label:a.data[t]},a)}))},_endEdit:(l,n,o)=>{const r={value:l.data[e.name],label:l.data[t]},u=i.value;let d="";if(n){const n=i.value;l.data[e.name]=n,l.data[t]=d=null==n||""===n?"":"string"==typeof a?"string"==typeof n||"number"==typeof n?datetime_utils_1.default.convertDateToString(datetime_utils_1.default.convertStringToDate(String(n)),a):datetime_utils_1.default.convertDateToString(n,a):a("string"==typeof n||"number"==typeof n?datetime_utils_1.default.convertStringToDate(String(n)):n)}react_dom_1.default.unmountComponentAtNode(o),e.endedEdit&&e.endedEdit({before:r,after:n?{value:u,label:d}:r},l,n)},editedRowData:e.optimizeEditedRowData?a=>{a[t]=l(a[e.name]),e.editedRowData&&e.editedRowData(a)}:e.editedRowData,jsxStyle:react_1.default.createElement(react_1.default.Fragment,null,input_column_1.default,exports.ListViewDateBoxColumnStyle)}};exports.default=ListViewDateBoxColumn;const DateBoxColumn=({bind:e,options:t})=>{const a=(0,controller_1.default)();return(0,react_1.useEffect)((()=>{a.focus()}),[]),react_1.default.createElement(datebox_1.default,{controller:a,name:"value",bind:e,style:{height:"100%",width:"100%"},pulldownButton:!1,...t})};exports.ListViewDateBoxColumnStyle=react_1.default.createElement(style_1.default,{id:exports.listViewDateBoxColumnClassName,notDepsColor:!0,notDepsDesign:!0,css:()=>"\n"});