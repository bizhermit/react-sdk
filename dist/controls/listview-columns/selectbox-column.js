"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(e,t,l,a){void 0===a&&(a=l),Object.defineProperty(e,a,{enumerable:!0,get:function(){return t[l]}})}:function(e,t,l,a){void 0===a&&(a=l),e[a]=t[l]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var l in e)"default"!==l&&Object.prototype.hasOwnProperty.call(e,l)&&__createBinding(t,e,l);return __setModuleDefault(t,e),t},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ListViewSelectBoxColumnStyle=exports.listViewSelectBoxColumnClassName=void 0;const react_1=__importStar(require("react")),react_dom_1=__importDefault(require("react-dom")),controller_1=__importDefault(require("../../hooks/controller")),input_column_1=__importStar(require("../../layouts/input-column")),style_1=__importStar(require("../../layouts/style")),listview_1=require("../listview"),selectbox_1=__importDefault(require("../selectbox"));exports.listViewSelectBoxColumnClassName="bh-lv_c-slb";const ListViewSelectBoxColumn=e=>{const t=e.labelDataName??`_lbl_${e.name}`,l=e.selectBoxOptions?.valueDataName??"value",a=e.selectBoxOptions?.labelDataName??"label";let o={value:""},n=[],i=!0;return null==e.source?(n=[],i=!1):Array.isArray(e.source)?(n=e.source,i=!1):(async()=>{try{n=await e.source(),i=!1}catch{console.log("failed: load selectbox column source"),n=[]}})(),{...e,name:t,initialize:()=>(0,listview_1.createListViewEditColumnElement)(),cellInitialize:(e,t)=>{e.element.classList.add(input_column_1.listViewInputColumnClassName,"bh-listview-selectbox");const l=(0,listview_1.cloneListViewEditColumnElement)(t);l.wrapElem.appendChild(l.lblElem),e.element.appendChild(l.wrapElem),e.contentElements.push(l.lblElem)},bindedItems:o=>{const i={};o.forEach((o=>o[t]=(e=>{if(e in i)return i[e];const t=n.find((t=>t[l]===e));return i[e]=(t?t[a]:"")??""})(o[e.name])))},_beginEdit:({target:l,editElement:a,endEdit:r,styleCtx:u})=>{!0!==e.disabled&&(i?r(!1):react_dom_1.default.render(react_1.default.createElement(style_1.StyleContext.Provider,{value:u},react_1.default.createElement(SelectBoxColumn,{bind:o={value:l.data[e.name]??null},source:n,options:e.selectBoxOptions})),a,(()=>{e.beganEdit?.({value:l.data[e.name],label:l.data[t]},l)})))},_endEdit:(i,r,u)=>{const s={value:i.data[e.name],label:i.data[t]},c=o.value;let d="";if(r){i.data[e.name]=c;const o=n.find((e=>e[l]===c));i.data[t]=d=(o?o[a]:"")??""}react_dom_1.default.unmountComponentAtNode(u),e.endedEdit?.({before:s,after:r?{value:c,label:d}:s},i,r)},jsxStyle:react_1.default.createElement(react_1.default.Fragment,null,input_column_1.default,exports.ListViewSelectBoxColumnStyle)}};exports.default=ListViewSelectBoxColumn;const SelectBoxColumn=({bind:e,options:t,source:l})=>{const a=(0,controller_1.default)();return(0,react_1.useEffect)((()=>{setTimeout((()=>a.focus()),0)}),[]),react_1.default.createElement(selectbox_1.default,{controller:a,name:"value",bind:e,source:l,style:{height:"100%",width:"100%"},...t,resize:!1})};exports.ListViewSelectBoxColumnStyle=react_1.default.createElement(style_1.default,{id:exports.listViewSelectBoxColumnClassName,notDepsColor:!0,notDepsDesign:!0,css:()=>"\n"});